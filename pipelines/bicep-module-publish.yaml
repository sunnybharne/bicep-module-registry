name: 'Bicep Module Publish Pipeline'
trigger:
  branches:
    include:
      - main
    exclude:
      - test/*
  paths:
    include:
      - modules/*
      - pipelines/bicep-modules-publish.yaml
    exclude:
      - README.md
      - modules/README.md
  tags:
    include:
      - v1*
    exclude:
      - testrelease

pool:
  name: 'selfhosted'

parameters:
- name: azureServiceConnection
  type: string
  default: 'id-platformiac-nonprod-sc-01'

jobs:
  - job: 
    displayName: 'Push Modules'
    steps:
      - task: AzurePowerShell@5
        inputs:
          displayName: AzurePowerShell
          azureSubscription: '${{ parameters.azureServiceConnection }}'
          ScriptType: 'InlineScript'
          Inline: |
            Get-InstalledModule -Name Az.Accounts -AllVersions
            echo testing
          azurePowerShellVersion: 'Latest'
          pwsh: true


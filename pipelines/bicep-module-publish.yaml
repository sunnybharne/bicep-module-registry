name: 'Bicep Module Publish'
trigger:
  branches:
    include:
      - main
  paths:
    include:
      - pipelines/*

pool:
  name: 'selfhosted'

parameters:
- name: azureServiceConnection
  type: string
  default: 'id-platformiac-nonprod-sc-01'

jobs:
  - job: 
    displayName: 'Push Modules'
    steps:
      - task: AzurePowerShell@5
        inputs:
          displayName: AzurePowerShell
          azureSubscription: '${{ parameters.azureServiceConnection }}'
          ScriptType: 'InlineScript'
          Inline: |
            echo Started Script
            if git diff --name-only HEAD HEAD~ | grep -q '^modules/resource/.*\.bicep$'; then
              echo "Changes detected in ./modules/resource folder."
              echo "Publishing modules to Azure DevOps Artifacts."
            else
              echo "No changes in ./modules/resource folder."
            fi
            echo "Printing Git Diff"
          azurePowerShellVersion: 'Latest'
          pwsh: true


          
